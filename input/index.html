
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>マウスやキーボードによる入力 - コンテンツインタラクション演習</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="コンテンツインタラクション演習" class="md-header__button md-logo" aria-label="コンテンツインタラクション演習" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            コンテンツインタラクション演習
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              マウスやキーボードによる入力
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="コンテンツインタラクション演習" class="md-nav__button md-logo" aria-label="コンテンツインタラクション演習" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    コンテンツインタラクション演習
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        環境構築
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          2D 線・円
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2D 線・円" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          2D 線・円
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lines/" class="md-nav__link">
        直線
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../circle/" class="md-nav__link">
        円
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../surface/" class="md-nav__link">
        2D 相対移動
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../box/" class="md-nav__link">
        3D 階層構造
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../animation/" class="md-nav__link">
        アニメーション
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          マウスやキーボードによる入力
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        マウスやキーボードによる入力
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    目次
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    準備
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    プログラムの解説
  </a>
  
    <nav class="md-nav" aria-label="プログラムの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    キーボードに連動する関数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    コールバック関数の登録
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    他のコールバック関数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    方向キーで立方体を動かす
  </a>
  
    <nav class="md-nav" aria-label="方向キーで立方体を動かす">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    プログラムの書き換え
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    課題1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    "押しっぱなし"の取得
  </a>
  
    <nav class="md-nav" aria-label=""押しっぱなし"の取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    フラグによる制御
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    課題2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    方向キーでキャラクターを動かす
  </a>
  
    <nav class="md-nav" aria-label="方向キーでキャラクターを動かす">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    準備-ロボットの表示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    進行方向の制御
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    歩行アニメーションの追加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    課題3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    課題4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../oneclick/" class="md-nav__link">
        ワンクリックアクションの制作
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../timing/" class="md-nav__link">
        タイミングアクション
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../trace/" class="md-nav__link">
        軌跡を用いたインタラクション
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    目次
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    準備
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    プログラムの解説
  </a>
  
    <nav class="md-nav" aria-label="プログラムの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    キーボードに連動する関数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    コールバック関数の登録
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    他のコールバック関数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    方向キーで立方体を動かす
  </a>
  
    <nav class="md-nav" aria-label="方向キーで立方体を動かす">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    プログラムの書き換え
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    課題1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    "押しっぱなし"の取得
  </a>
  
    <nav class="md-nav" aria-label=""押しっぱなし"の取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    フラグによる制御
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    課題2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    方向キーでキャラクターを動かす
  </a>
  
    <nav class="md-nav" aria-label="方向キーでキャラクターを動かす">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    準備-ロボットの表示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    進行方向の制御
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    歩行アニメーションの追加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    課題3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    課題4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>マウスやキーボードによる入力</h1>

<p>この資料は、従来版の後半第1回 - キーボードやマウスによる入力 に対応します。
<a href="https://github.com/trnciii/ciesample-input">このリポジトリ</a>からファイルをダウンロードしたら<code>sample.xcodeproj</code> を開き、実行できるか確認してください。</p>
<h2 id="_1">目次</h2>
<ul>
<li><a href="#準備">準備</a></li>
<li><a href="#プログラムの解説">プログラムの解説</a><ul>
<li><a href="#キーボードに連動する関数">キーボードに連動する関数</a></li>
<li><a href="#コールバック関数の登録">コールバック関数の登録</a></li>
<li><a href="#他のコールバック関数">他のコールバック関数</a></li>
</ul>
</li>
<li><a href="#方向キーで立方体を動かす">方向キーで立方体を動かす</a><ul>
<li><a href="#プログラムの書き換え">プログラムの書き換え</a></li>
<li><a href="#課題1">課題1</a></li>
</ul>
</li>
<li><a href="#&quot;押しっぱなし&quot;の取得">"押しっぱなし"の取得</a><ul>
<li><a href="#フラグによる制御">フラグによる制御</a></li>
<li><a href="#課題2">課題2</a></li>
</ul>
</li>
<li><a href="#方向キーでキャラクターを動かす">方向キーでキャラクターを動かす</a><ul>
<li><a href="*準備-ロボットの表示">準備-ロボットの表示</a></li>
<li><a href="*進行方向の制御">進行方向の制御</a></li>
<li><a href="*歩行アニメーションの追加">歩行アニメーションの追加</a></li>
<li><a href="*課題3">課題3</a></li>
<li><a href="*課題4">課題4</a></li>
</ul>
</li>
</ul>
<h2 id="_2">準備</h2>
<p>ここのコードをダウンロード、解凍してください。sample.xcodeproj を開き実行すると立方体が表示されることを確認してください。
また、矢印キーを押すとコンソールに対応した文字が出力されることを確認してください。
コンソールはXcodeウィンドウの右下にあります。</p>
<table>
<thead>
<tr>
<th align="center">ウィンドウ</th>
<th align="center">コンソール</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img src="docs/cube.png" width="400"></td>
<td align="center"><img src="docs/console.png" width="350"></td>
</tr>
</tbody>
</table>
<h2 id="_3">プログラムの解説</h2>
<p>今回からキーボードやマウスの動きなど、ユーザーによる入力を利用したプログラムを書きます。
そのために<strong>コールバック関数</strong>という仕組みを利用します。
これはGLFWのほうで検知した特定の動作に対して、登録した好きな関数を実行できるというものです。</p>
<p>実際にキーボードにあわせて矢印を出力する部分がどのように書かれているか見ていきます。</p>
<h3 id="_4">キーボードに連動する関数</h3>
<p>キーボードが押されたときに動作する関数として、<code>KeyFunc</code>を定義しました。
関数の引数は<a href="https://www.glfw.org/docs/3.3/group__input.html#ga0192a232a41e4e82948217c8ba94fdfd">仕様</a>で決まっており、キーの種類や動作を表す変数として関数内で使うことができます。</p>
<pre><code class="language-cpp">void KeyFunc(GLFWwindow* window, int key, int scancode, int action, int mods)
{
    // ↑
    if( key == GLFW_KEY_UP &amp;&amp; action == GLFW_PRESS ){
        printf(&quot;↑\n&quot;);
    }

    // ↓
    if( key == GLFW_KEY_DOWN &amp;&amp; action == GLFW_PRESS ){
        printf(&quot;↓\n&quot;);
    }

    // ←
    if( key == GLFW_KEY_LEFT &amp;&amp; action == GLFW_PRESS ){
        printf(&quot;←\n&quot;);
    }

    // →
    if( key == GLFW_KEY_RIGHT &amp;&amp; action == GLFW_PRESS ){
        printf(&quot;→\n&quot;);
    }

    // スペースキー
    if( key == GLFW_KEY_SPACE &amp;&amp; action == GLFW_PRESS ){
        printf(&quot;SPACE\n&quot;);
    }

    // Aキー
    if( key == 'A' &amp;&amp; action == GLFW_PRESS ){
        printf( &quot;A\n&quot; );
    }
}
</code></pre>
<p>この関数では、どのキーが押されたかによって処理を分岐し、文字を出力しています。</p>
<p>キーの種類は関数の第二引数<code>int key</code> に入っています。
文字の場合は文字コード、矢印など特殊なものはGLFWで用意された <code>GLFW_KEY_UP</code> などの値が入っています。</p>
<p>キーが押されたことを判定するために、分岐のときに第四引数<code>int action</code> の値も同時に確認します。
この変数には、押された瞬間に<code>GLFW_PRESS</code>、離された瞬間には<code>GLFW_RELEASE</code>がはいっています。</p>
<h3 id="_5">コールバック関数の登録</h3>
<p>プログラムの最初に、定義した関数<code>KeyFunc</code>をGLFWにわかるように登録します。
これは <code>main</code>関数内の <code>glfwSetKeyCallback(window, KeyFunc);</code> という部分で行っています。</p>
<h3 id="_6">他のコールバック関数</h3>
<p>キーボードの検出のほかにも以下のコールバック関数を用意しています。
プログラムを読み、それぞれの引数と関数を登録している部分を確認してください。</p>
<table>
<thead>
<tr>
<th align="left">関数名</th>
<th align="left">内容</th>
<th align="left">引数(使うもの)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">KeyFunc</td>
<td align="left">キーボードの動作を検出</td>
<td align="left">キーや動作の種類</td>
</tr>
<tr>
<td align="left">MouseButtonFunc</td>
<td align="left">マウスボタンの動作を検出</td>
<td align="left">ボタンと動作の種類</td>
</tr>
<tr>
<td align="left">MousePosFunc</td>
<td align="left">マウスの移動を検出</td>
<td align="left">座標(x, y)</td>
</tr>
<tr>
<td align="left">MouseWheelFunc</td>
<td align="left">ホイールの動作を検出</td>
<td align="left">ホイールの移動(x, y)</td>
</tr>
</tbody>
</table>
<h2 id="_7">方向キーで立方体を動かす</h2>
<p>入力された方向キーで立方体を移動させます。↑キーで上、↓キーで下に動くようにします。</p>
<h3 id="_8">プログラムの書き換え</h3>
<p>まず、位置を格納する大域変数を用意します。</p>
<pre><code class="language-cpp">#include &quot;GLFW/glfw3.h&quot;
#include &lt;math.h&gt;
#include &quot;box.hpp&quot;
#include &lt;stdio.h&gt;
#include &lt;stdio.h&gt;

double pos_z = 0; // 追加

// 登場する関数(いつもの)
void myinit(GLFWwindow** window);
</code></pre>
<p>次に<code>KeyFunc</code>の中でキーボードの入力によって<code>pos_z</code>を更新します。</p>
<pre><code class="language-cpp">void KeyFunc(GLFWwindow* window, int key, int scancode, int action, int mods)
{
    // ↑
    if( key == GLFW_KEY_UP &amp;&amp; action == GLFW_PRESS ){
        printf(&quot;↑\n&quot;);
        pos_z -= 0.5; // 追加
    }

    // ↓
    if( key == GLFW_KEY_DOWN &amp;&amp; action == GLFW_PRESS ){
        printf(&quot;↓\n&quot;);
        pos_z += 0.5; // 追加
    }
// ...
</code></pre>
<p>最後<code>display</code>のほうで立方体を<code>pos_z</code>だけ移動させます。</p>
<pre><code class="language-cpp">void display(int frame)
{
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    glTranslated( 0.0, 0.0, pos_z );
    makebox(1.0, 1.0, 1.0, GL_POLYGON);
}
</code></pre>
<p>これで実行すると、矢印キーの上下に応じて立方体が移動します。</p>
<h3 id="1">課題1</h3>
<p>矢印キーの左右に応じて立方体が移動するようにしてください。
後から使うので、左右の移動を保持する変数名は<code>pos_x</code> とすることを推奨します。</p>
<h2 id="_9">"押しっぱなし"の取得</h2>
<p>今までの流れで、矢印キーを押す事で立方体が動くようになりました。
ただ、動かし続けるためにはキーボードを連打する必要があります。
ここでは、「押しっぱなし」の取得をしたいと思います。</p>
<h3 id="_10">フラグによる制御</h3>
<p><code>KeyFunc</code>ではキーが押された/離された瞬間のみを検知することができますが、その後キーが押されたままであるかはわかりません。
そのため、キーが押されているか否かの変数を用意して、これをもとに移動をおこないます。</p>
<p>以下のように変数の用意と移動の書き換えをおこないます。
ここで使う<code>bool</code> は真偽値を扱う型で、値として<code>true</code> または <code>false</code> をとります。</p>
<pre><code class="language-cpp">double pos_x = 0.0;
double pos_z = 0.0;

// 大域変数として以下の各方向のフラグを定義
bool up = false;
bool down   = false;
bool left   = false;
bool right  = false;

// 中略

//--描画内容--------------------------------------------------------------------
void display(int frame)
{
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    // フラグがtrueのときに各方向に移動する
    if( up ){
        pos_z -= 0.1;
    }
    if( down ){
        pos_z += 0.1;
    }
    if( left ){
        pos_x -= 0.1;
    }
    if( right ){
        pos_x += 0.1;
    }

    glTranslated( pos_x, 0.0, pos_z );
    makebox(1.0, 1.0, 1.0, GL_POLYGON);
}
</code></pre>
<p>最後に、<code>KeyFunc</code>の中で各方向のフラグを更新します。</p>
<h3 id="2">課題2</h3>
<p><code>KeyFunc</code>を書き換えて、矢印キーとフラグ変数<code>up, down, left, right</code>が連動するようにしてください。
キーを押した瞬間に<code>true</code>, キーを離した瞬間に<code>false</code>を代入すればいいです。</p>
<h2 id="_11">方向キーでキャラクターを動かす</h2>
<h3 id="-">準備-ロボットの表示</h3>
<p>キャラクターを動かすことで、さまざまな制御に慣れましょう。
かなり長いですが、立方体の描画を以下のロボットで置き換えます。</p>
<pre><code class="language-cpp">glPushMatrix();
    /* 腰 */
    glScalef(0.3, 0.3, 0.3);
    glTranslated( pos_x, 0.0, pos_z ); //全体の移動
    // glRotated( dir, 0.0, 1.0, 0.0 );//全体の回転

    glColor3d(0.0, 1.0, 1.0);
    makeboxROBOT( 1.3, 0.7, 1.0, GL_POLYGON );//腰パーツ

    /* 胴体 */
    glPushMatrix();
        glTranslated(0.0, 0.4, 0.0);
        glRotated( 0.0, 0.0, 0.0, 0.0 );//胴体の回転*****
        glTranslated(0.0, 0.3, 0.0);
        glColor3d(0.8, 0.0, 0.0);
        makeboxROBOT( 0.6, 1.0, 0.6, GL_POLYGON );//腹パーツ

        glTranslated(0.0, 0.6, 0.0);
        glColor3d(1.0, 0.0, 0.0);
        makeboxROBOT( 1.8, 1.2, 1.0, GL_POLYGON );//胸パーツ

        glTranslated(0.0, 0.3, 0.0);

        /* 左手 */
        glPushMatrix();
            glTranslated(1.3, 0.0, 0.0);

            glRotated( 0.0, 0.0, 0.0, 0.0 );//左上腕の回転*****

            glTranslated(0.0, -0.5, 0.0);
            glColor3d(0.0, 1.0, 0.0);
            makeboxROBOT( 0.5, 1.5, 0.5, GL_POLYGON );//上腕パーツ

            glTranslated(0.0, -0.5, 0.0);
            glPushMatrix();
                glTranslated(0.0, 0.0, 0.0);
                glRotated(-40.0, 1.0, 0.0, 0.0);

                glRotated( 0.0, 0.0, 0.0, 0.0 );//左腕の回転*****

                glTranslated(0.0, -0.5, 0.0);
                glColor3d(0.0, 0.8, 0.0);
                makeboxROBOT( 0.6, 1.6, 0.7, GL_POLYGON );//腕パーツ

                glTranslated(0.0, -0.9, 0.0);
                glColor3d(1.0, 1.0, 0.0);
                makeboxROBOT( 0.5, 0.7, 0.5, GL_POLYGON );//手パーツ
            glPopMatrix();
        glPopMatrix();

        /* 右手 */
        glPushMatrix();
            glTranslated(-1.3, 0.0, 0.0);

            glRotated( 0.0, 0.0, 0.0, 0.0 );//右上腕の回転*****

            glTranslated(0.0, -0.5, 0.0);
            glColor3d(0.0, 1.0, 0.0);
            makeboxROBOT( 0.5, 1.5, 0.5, GL_POLYGON );//上腕パーツ

            glTranslated(0.0, -0.5, 0.0);
            glPushMatrix();
                glTranslated(0.0, 0.0, 0.0);
                glRotated(-40.0, 1.0, 0.0, 0.0);

                glRotated( 0.0, 0.0, 0.0, 0.0 );//右腕の回転*****

                glTranslated(0.0, -0.5, 0.0);
                glColor3d(0.0, 0.8, 0.0);
                makeboxROBOT( 0.6, 1.6, 0.7, GL_POLYGON );//腕パーツ

                glTranslated(0.0, -0.9, 0.0);
                glColor3d(1.0, 1.0, 0.0);
                makeboxROBOT( 0.5, 0.7, 0.5, GL_POLYGON );//手パーツ
            glPopMatrix();
        glPopMatrix();

        /* 頭 */
        glPushMatrix();
            glTranslated(0.0, 0.4, 0.0);
            glRotated( 0.0, 0.0, 0.0, 0.0 );//頭の回転*****
            glColor3d(0.8, 0.8, 0.0);
            makeboxROBOT( 0.4, 1.2, 0.4, GL_POLYGON );//首パーツ

            glTranslated(0.0, 0.6, 0.0);
            glColor3d(1.0, 1.0, 0.0);
            makeboxROBOT( 1.0, 1.0, 1.0, GL_POLYGON );//頭パーツ
        glPopMatrix();
    glPopMatrix();

    /* 右足 */
    glPushMatrix();
        glTranslated(-0.6, -0.7, 0.0);
        glRotated(-10.0, 1.0, 0.0, 0.0);
        glRotated( 0.0, 0.0, 0.0, 0.0 );//右腿の回転*****

        glTranslated(0.0, -0.5, 0.0);
        glColor3d(0.0, 1.0, 0.0);
        makeboxROBOT( 0.5, 1.5, 0.5, GL_POLYGON );//腿パーツ

        glTranslated(0.0, -0.5, 0.0);

        glPushMatrix();
            glTranslated(0.0, 0.0, 0.0);
            glRotated(20.0, 1.0, 0.0, 0.0);

            glRotated( 0.0, 0.0, 0.0, 0.0 );//右脛の回転*****

            glTranslated(0.0, -0.5, 0.0);
            glColor3d(0.0, 0.8, 0.0);
            makeboxROBOT( 0.6, 1.6, 0.7, GL_POLYGON );//脛パーツ

            glTranslated(0.0, -1.4, 0.3);
            glColor3d(1.0, 1.0, 0.0);
            glRotated(10.0, 1.0, 0.0, 0.0);
            makeboxROBOT( 0.7, 0.6, 1.4, GL_POLYGON );//足パーツ
        glPopMatrix();
    glPopMatrix();

    /* 左足 */
    glPushMatrix();
        glTranslated(0.6, -0.7, 0.0);
        glRotated(-10.0, 1.0, 0.0, 0.0);

        glRotated( 0.0, 0.0, 0.0, 0.0 );//左腿の回転*****

        glTranslated(0.0, -0.5, 0.0);
        glColor3d(0.0, 1.0, 0.0);
        makeboxROBOT( 0.5, 1.5, 0.5, GL_POLYGON );//腿パーツ

        glTranslated(0.0, -0.5, 0.0);

        glPushMatrix();
            glTranslated(0.0, 0.0, 0.0);
            glRotated(20.0, 1.0, 0.0, 0.0);

            glRotated( 0.0, 0.0, 0.0, 0.0 );//左脛の回転*****

            glTranslated(0.0, -0.5, 0.0);
            glColor3d(0.0, 0.8, 0.0);
            makeboxROBOT( 0.6, 1.6, 0.7, GL_POLYGON );//脛パーツ

            glTranslated(0.0, -1.4, 0.3);
            glColor3d(1.0, 1.0, 0.0);
            glRotated(10.0, 1.0, 0.0, 0.0);
            makeboxROBOT( 0.7, 0.6, 1.4, GL_POLYGON );//足パーツ

        glPopMatrix();
    glPopMatrix();
glPopMatrix();
</code></pre>
<p>ロボットが表示され、<code>pos_x, pos_z</code>によって全体の移動ができることを確認してください。</p>
<p><img alt="" src="docs/robot.png" /></p>
<h3 id="_12">進行方向の制御</h3>
<p>立方体のときには気になりませんでしたが、キャラクターが移動するときには進行方向を向いてもらう方が自然に感じられますので、キーで入力した方向に応じてロボットを回転させます。</p>
<p>やることは移動と同じです。大域変数に方向を入れる変数<code>float dir</code> を用意し、キーのフラグを利用して値を決めます。
回転は、ロボットの上のほうにある腰パーツでおこないます。<code>//全体の回転</code>となっている部分をコメントアウトして利用してください。</p>
<pre><code class="language-cpp">// 大域変数
float pos_x = 0;
float pos_z = 0;

bool up = false;
bool down = false;
bool left = false;
bool right = false;

float dir = 0; // 追加

// 中略

void display(int frame)
{
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    if(up){
        pos_z -= 0.1;
        dir = 180;
    }

    if(down){
        pos_z += 0.1;
        dir = 0;
    }

    if(left){
        pos_x -= 0.1;
        dir = -90;
    }

    if(right){
        pos_x += 0.1;
        dir = 90;
    }

    // ロボットの描画
</code></pre>
<p>これでロボットの向きを変えることができました。</p>
<p><img alt="" src="docs/move.gif" /></p>
<h3 id="_13">歩行アニメーションの追加</h3>
<p>さらに、移動しているときには歩いているようなアニメーションを加えてみましょう。
とりあえず脚だけ振らせてみます。
歩行の一周期を0\~360度として回転し続ける変数<code>phase</code> を用意し、いずれかの方向キーが押されているときに値を更新します。</p>
<p>また、股関節や膝の回転を更新します。</p>
<pre><code class="language-cpp">// 大域変数
float pos_x = 0;
float pos_z = 0;

bool up = false;
bool down = false;
bool left = false;
bool right = false;

float dir = 0;
float phase = 0; // 追加

// 中略

// 各変数の更新
    if(up){
        pos_z -= 0.1;
        dir = 180;
    }

    if(down){
        pos_z += 0.1;
        dir = 0;
    }

    if(left){
        pos_x -= 0.1;
        dir = -90;
    }

    if(right){
        pos_x += 0.1;
        dir = 90;
    }

    // 何らかのキーが押されているとき
    if(up || down || left || right){
        // phase が0~360度をまわる
        phase++;
        if(phase&gt;360)phase = 0;
    }

    // ロボットの描画
</code></pre>
<p>また、ロボットの脚にある以下の部分のパラメータを埋め、回転させます。(コメントを参考に探してください)</p>
<ul>
<li><code>glRotated( 10*sin(phase*0.2), 1.0, 0.0, 0.0 );//右腿の回転*****</code></li>
<li><code>glRotated( 10*sin(phase*0.2), 0.0, 0.0, 0.0 );//右脛の回転*****</code></li>
<li><code>glRotated(-10*sin(phase*0.2), 1.0, 0.0, 0.0 );//左腿の回転*****</code></li>
<li><code>glRotated(-10*sin(phase*0.2), 1.0, 0.0, 0.0 );//左脛の回転*****</code></li>
</ul>
<p>完成するとこのようになります。</p>
<p><img alt="" src="docs/walk.gif" /></p>
<h3 id="3">課題3</h3>
<p>以下の問題点を解決するよう移動の制御を改善してください。</p>
<p><strong>問題点</strong> 現在、二つのキーを同時に押すと斜めに移動するころができるが、ロボットの向きは四方向のいずれかとなってしまうので、複数のキーを押してもロボットが進行方向を向くようにしたい。</p>
<h3 id="4">課題4</h3>
<p>立方体または適当なキャラクターをひとつ、マウスカーソルを追いかけるように動かしてください。</p>
<p><img alt="" src="docs/follow.gif" /></p>
<p>マウスカーソルの位置は<code>MousePosFunc</code>の引数である<code>x, y</code>から取り出して利用します。
斜めからの視点では、カーソルの位置とロボットの移動する平面の対応を厳密に考えるのは難しいので、そのあたりは適当でいいです。</p>
<hr />
<p>課題のほかにも、アニメーションや移動方法を変更してみてください。
また、作品をslack のほうに共有してくれると嬉しいです。</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../animation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: アニメーション" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              アニメーション
            </div>
          </div>
        </a>
      
      
        
        <a href="../oneclick/" class="md-footer__link md-footer__link--next" aria-label="Next: ワンクリックアクションの制作" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              ワンクリックアクションの制作
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
    
  </body>
</html>