
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>3D 階層構造 - コンテンツインタラクション演習</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="コンテンツインタラクション演習" class="md-header__button md-logo" aria-label="コンテンツインタラクション演習" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            コンテンツインタラクション演習
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3D 階層構造
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="コンテンツインタラクション演習" class="md-nav__button md-logo" aria-label="コンテンツインタラクション演習" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    コンテンツインタラクション演習
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        環境構築
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          2D 線・円
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2D 線・円" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          2D 線・円
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lines/" class="md-nav__link">
        直線
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../circle/" class="md-nav__link">
        円
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../surface/" class="md-nav__link">
        2D 相対移動
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          3D 階層構造
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        3D 階層構造
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    目次
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    準備
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    プログラムの概要
  </a>
  
    <nav class="md-nav" aria-label="プログラムの概要">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    立方体の描画
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    透視投影の設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    陰面消去
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    課題1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    階層構造
  </a>
  
    <nav class="md-nav" aria-label="階層構造">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    階層構造とは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    階層構造のつくりかた
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    課題2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../animation/" class="md-nav__link">
        アニメーション
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../input/" class="md-nav__link">
        マウスやキーボードによる入力
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../oneclick/" class="md-nav__link">
        ワンクリックアクションの制作
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../timing/" class="md-nav__link">
        タイミングアクション
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../trace/" class="md-nav__link">
        軌跡を用いたインタラクション
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    目次
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    準備
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    プログラムの概要
  </a>
  
    <nav class="md-nav" aria-label="プログラムの概要">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    立方体の描画
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    透視投影の設定
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    陰面消去
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    課題1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    階層構造
  </a>
  
    <nav class="md-nav" aria-label="階層構造">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    階層構造とは
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    階層構造のつくりかた
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    課題2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>3D 階層構造</h1>

<p>この資料は、従来版の第３回 - 3D 階層構造 に対応します。
<a href="https://github.com/trnciii/ciesample-box">このリポジトリ</a>からファイルをダウンロードしたら<code>sample.xcodeproj</code> を開き、実行できるか確認してください。</p>
<h2 id="_1">目次</h2>
<ul>
<li><a href="#準備">準備</a><br></li>
<li><a href="#プログラムの概要">プログラムの概要</a><br><ul>
<li><a href="#立方体の描画">立方体の描画</a></li>
<li><a href="#透視投影の設定">透視投影の設定</a></li>
</ul>
</li>
<li><a href="#陰面消去">陰面消去</a></li>
<li><a href="#課題1">課題1</a></li>
<li><a href="#階層構造">階層構造</a><ul>
<li><a href="#階層構造とは">階層構造とは</a></li>
<li><a href="#階層構造のつくりかた">階層構造のつくりかた</a></li>
</ul>
</li>
<li><a href="#課題2">課題2</a></li>
</ul>
<h2 id="_2">準備</h2>
<p>ここのコードをダウンロード、解凍してください。sample.xcodeproj を開き実行すると立方体が表示されることを確認してください。</p>
<p><em>macでよくあるのですが、実質的な画面の解像度がソフトウェア上の表示と異なっているために表示領域がおかしくなることがあります。その場合はウィンドウを移動させたり拡大/縮小すると正しい表示になります。</em></p>
<h2 id="_3">プログラムの概要</h2>
<p>このプログラムでは、これまでの平行投影法と違い <strong>透視投影法</strong> によって立方体を描画しています。
main.cpp の中にある関数<code>display()</code>の中で<code>makebox(1.0, 1.0, 1.0);</code>という関数が使用されており、これで以下の図のように幅, 高さ, 奥行がそれぞれ1である立方体を描画します。<br>
<img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/makebox.jpg" /></p>
<h3 id="_4">立方体の描画</h3>
<p>立方体を作る関数<code>makebox</code>は、box.hpp, box.cpp という2つのファイルの中に定義されています。<br>
<img alt="" src="docs/im_files.png" /><br>
box.hpp の中を確認してみると、makebox の定義は　<code>makebox(width, height, length, type);</code> となっており、引数は順に <strong> <em>x方向の大きさ, y方向の大きさ, z方向の大きさ, 描画タイプ</em> </strong> を指定します。</p>
<h3 id="_5">透視投影の設定</h3>
<p>透視投影の設定は main.cpp の <code>reshape</code> 内で行っています。</p>
<pre><code class="language-cpp">void reshape(GLFWwindow* window, int w, int h)
{
    glViewport( 0, 0, (GLsizei)w, (GLsizei)h ); //ウィンドウ全体をビューポートにする
    glMatrixMode( GL_PROJECTION );
    glLoadIdentity(); //変換行列の初期化 

    gluPerspective(30.0, (double)w / (double)h, 1.0, 100.0);
    gluLookAt(
        3.0, 4.0, 5.0,    //どこから見てるか
        0.0, 0.0, 0.0,    //どこを見てるか
        0.0, 1.0, 0.0    //どの向きが上向きか
    );
}
</code></pre>
<p>gluPerspective();では透視投影法の視体積を設定しています。
括弧左から、視野角、縦横比、手前の座標、奥の座標を設定し、この範囲内にある物体を表示します。</p>
<p><code>gluPerspactive(th, w/h, near, far)</code>のとき次の図のようになります<br>
<img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/viewport2.jpg" /></p>
<p>関数<code>gluLookAt</code>は視点の設定をしています。
最初の３つのパラメータは視点の位置です。次の３つのパラメータは注視点の位置を表しています。このサンプルでは、カメラは位置(3.0, 4.0, 5.0)から原点(0.0, 0.0, 0.0) のほうを向いています。</p>
<p>最後の３つのパラメータで、どちらが「上」かということを決めており、この場合y軸が上になります。これによってカメラの傾きを決めています。</p>
<h2 id="_6">陰面消去</h2>
<p>物体の裏側が見えないことや、物体の一部がその他の物体にさえぎられて見えないような状況は実世界では当然のことです。しかし、CGではこれらをちゃんと設定しない限り、いわゆる”正しい”表示にはなりません。
この「本来見えない面を消す」ことを、隠面消去といいます。</p>
<p>このことを確認してみましょう。main.cpp の<code>display</code>関数を以下のように書き換えて、ポリゴンで立方体を表示するように切り替えましょう。</p>
<pre><code class="language-cpp">void display(void)
{
    glClear(GL_COLOR_BUFFER_BIT);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    // makebox(1.0,1.0,1.0);
    // ↓　ポリゴン表示に書き換え
    makebox(1.0, 1.0, 1.0, GL_POLYGON);
}
</code></pre>
<p>このプログラムを実行すると面の前後関係が正しく表示されない、以下のような状態になります。<br>
<img alt="" src="docs/im_noDepth.png" /><bt></p>
<p>陰面消去をおこなうには、二つの関数<code>myinit</code>と<code>display</code>を以下のように書き換えます。</p>
<p>[ myinit関数 ]</p>
<pre><code class="language-cpp">void myinit(GLFWwindow** window)
{
    glfwInit();

    int w = 600;
    int h = 600;
    *window = glfwCreateWindow(w, h, &quot;surface&quot;, NULL, NULL);
    glClearColor(0, 0, 0, 1);

    reshape(*window, w, h);
    glEnable(GL_DEPTH_TEST); // 追加
}
</code></pre>
<p>[ display関数 ]</p>
<pre><code class="language-cpp">void display(void)
{
    // glClear(GL_COLOR_BUFFER_BIT);
    // ↓ GL_DEPTH_BUFFER_BIT　を追加
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    makebox(1.0,1.0,1.0,GL_POLYGON);
}
</code></pre>
<p>これで奥行を処理するデプスバッファを利用した描画を行うという指示ができました。正しく立方体を表示できたと思います。<br>
<img alt="" src="docs/im_depth.png" /><br>
デプスバッファというのはそれぞれの画素ごとにポリゴンまでの距離(奥行, 深度)を記録しておくもので、この情報を利用して一番手前にあるポリゴンを表示することができます。</p>
<p>ウィンドウ初期化のときに <code>glEnable(GL_DEPTH_TEST)</code> を書くことで、以降の描画で奥行のチェックして画素を書き換えるという設定をしています。また、毎フレームの最初にデプスバッファを初期化するため、<code>glClear</code>関数に <code>GL_DEPTH_BUFFER_BIT</code> を与えています。</p>
<h2 id="1">課題1</h2>
<p>前回までのプログラムを参考に、箱を増殖させて次のようなものを作ってみてください。<br>
<img src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/boxes2.PNG" width="300">
<img src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/boxes3.PNG" width="300">
<img src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/boxes4.PNG" width="300"></p>
<h2 id="_7">階層構造</h2>
<p>ボックスが綺麗に表示できるようになったところで、すこし複雑な表現をおこなってみましょう。このように複数のボックスがあるとします。<br>
<img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/boxes.jpg" /><br></p>
<!-- ### 課題2
下図のようにオブジェクトを配置してください。色や形は自由に変えていいです。<br>
![](http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/boxes.jpg)<br> -->

<h3 id="_8">階層構造とは</h3>
<p>ここで、Bのオブジェクトを動かすとAやCが一緒に動くようにするにはどうしたらいいでしょうか。</p>
<p>このような処理は、ひとまとまりのオブジェクトを一度に動かしたり（例：木を作ったとき、幹を移動させると、枝、葉が一緒に移動する→下図）、関節のある物体を作るとき（例：肩を回すと腕・肘・二の腕・指が一緒に回る）に必要になってきます。</p>
<table>
<thead>
<tr>
<th align="center">幹を動かせば木全体が動く(理想)</th>
<th align="center">幹を動かしても葉や枝が残ってしまう場合</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/tree_all.jpg" /></td>
<td align="center"><img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cge2020/img/3d/tree_sep.jpg" /></td>
</tr>
</tbody>
</table>
<p>これは、階層構造をつくる＝オブジェクトの間に親子関係をつくることで実現できます。<br>
<img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/oyako_1.gif" /></p>
<p>例えば、AがBの親のとき、Aが動くとBもAとの位置関係を保ったままついてきます。<br>
<img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/oyako_2.gif" /></p>
<p>Aがその場で回転するとどうなるでしょう？BはAの周りをぐるぐると回ることになります。<br>
<img alt="" src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/oyako_3.gif" /></p>
<p>一方Bがどんなに動いても、Aがついてきたりはしません。Bが拡大・縮小しても、その場で回転しても、Aには全く影響がありません。しかしやっぱり、散々Bが動いてAとの距離が相当に離れてしまっても、Aが移動するとその位置関係を保ったままBはついてきます。</p>
<h3 id="_9">階層構造のつくりかた</h3>
<p>OpenGLで階層構造を作るには、<code>glPopMatrix()</code>関数と<code>glPushMatrix()</code>関数を使います。 例として、<code>display()</code>で箱を出す部分を以下のように書き換えます。</p>
<pre><code class="language-cpp">glPushMatrix(); // 階層1
    glTranslated(0, 0, 0); // ★ 親に適用される
    makebox(1,1,1, GL_POLYGON); // A

    glPushMatrix(); // 階層2
        glTranslated(0, 1, 0); // ◆ 子の階層のみに適用される
        makebox(0.3,0.3,0.3, GL_POLYGON); // B
    glPopMatrix(); // 階層を戻る

glPopMatrix(); // 階層を戻る
</code></pre>
<p>最初の<code>glPushMatrix();</code>がひとつめの階層です。ここでボックスをひとつ描きます。このボックスをAとします。
そして、次の<code>glPushMatrix();</code>で階層を下りて、ボックスをひとつ描きます。このボックスをBとします。
次の行の<code>glPopMatrix();</code>は階層を戻るときに使います。これでボックスAを描いた階層と同じところに戻ります。
更に、もう一度<code>glPopMatrix();</code>をして、ひとつめの階層から脱出します。
ボックスAよりもボックスBのほうが下の階層にありますので、AはBの親（BはAの子）になります。</p>
<p>なお、インデントは階層をわかりやすくするためにつけています。</p>
<p>★の<code>glTranslated(0,0,0)</code>を引数を適当に変えてボックスを移動させてみましょう。ボックスBがボックスAに追従して移動します。<br>
<img src="docs/im_t1L.png" width="300">
<img src="docs/im_t1R.png" width="300"></p>
<p>一方で◆の<code>glTranslated(0,0,0)</code>を変更してみると、ボックスBだけを移動させることができます。<br>
<img src="docs/im_t2.png" width="300"></p>
<p>回転や拡大/縮小などの操作に関しても同様のはたらきがあります。</p>
<h3 id="2">課題2</h3>
<p>階層構造を使ってロボットを作って下さい。単純なものでもいいですし、人型のような複雑なものに挑戦してもいいです。胴体を動かすと脚や腕がついてくるといった操作が可能なものをつくり、さまざまな姿勢をとらせてください。<br>
<img src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/boxes.jpg" width="300">
<img src="http://www.design.kyushu-u.ac.jp/~rtsuruno/lectures/cie2022/img/3d/robo.GIF" width="300"></p>
<p>できた画像をキャプチャして、slackのほうに共有してくれると嬉しいです。</p>
<details>
    <summary>難しいという方へ...</summary>
    解答例をおいておきます。変形を行う関数`glTranslated`, `glRotated`などをいじってみて、階層構造のはたらきを理解しましょう。


<pre><code class="language-cpp">glPushMatrix();  //-- 胴
    glTranslated(0, -1.2, 0);
    makebox(1, 1, 1, GL_POLYGON);

    glPushMatrix();   // ----　頭
        glTranslated(0.0, 1.0, 0.0);
        makebox(1.0, 1.0, 1.0, GL_POLYGON);

        glPushMatrix(); // --- 左目
            glTranslated(0.25, 0.1, 0);
            glRotated(10, 0, 0, 1);
            glRotated(180, 0, 1, 0);
            makebox(0.3, 0.05, 1.2, GL_POLYGON);
        glPopMatrix();

        glPushMatrix(); // --- 左目
            glTranslated(-0.25, 0.1, 0);
            glRotated(-10, 0, 0, 1);
            glRotated(180, 0, 1, 0);
            makebox(0.3, 0.05, 1.2, GL_POLYGON);
        glPopMatrix();

        glPushMatrix(); // --- 口
            glTranslated(0, -0.2, 0);
            glRotated( 180, 0, 1, 0);
            makebox(0.7, 0.05, 1.2, GL_POLYGON);
        glPopMatrix();
    glPopMatrix(); // 頭おわり


    glPushMatrix();  //-- 右足
        glTranslated(-0.35, -1.2, 0);
        makebox(0.3, 1, 1, GL_POLYGON);
    glPopMatrix();


    glPushMatrix();  //-- 左足
        glTranslated( 0.35, -1.2, 0);
        makebox(0.3, 1, 1, GL_POLYGON);
    glPopMatrix();


    glPushMatrix();  //-- 右腕
        glTranslated(-1.2, 0.35, 0);
        makebox(1, 0.3, 1, GL_POLYGON);
    glPopMatrix();


    glPushMatrix();  //-- 左腕
        glTranslated( 1.2, 0.35, 0);
        makebox(1, 0.3, 1, GL_POLYGON);
    glPopMatrix();

glPopMatrix();

</code></pre>

</details>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../surface/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 2D 相対移動" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              2D 相対移動
            </div>
          </div>
        </a>
      
      
        
        <a href="../animation/" class="md-footer__link md-footer__link--next" aria-label="Next: アニメーション" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              アニメーション
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
    
  </body>
</html>