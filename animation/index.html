<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>アニメーション - コンテンツインタラクション演習</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3";
    var mkdocs_page_input_path = "animation/README.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> コンテンツインタラクション演習</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../setup/">環境構築</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">2D 線・円</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../lines/">直線</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../circle/">円</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../surface/">2D 相対移動</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../box/">3D 階層構造</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">アニメーション</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../input/">マウスやキーボードによる入力</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../oneclick/">ワンクリックアクションの制作</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../timing/">タイミングアクション</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../trace/">軌跡を用いたインタラクション</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">コンテンツインタラクション演習</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>アニメーション</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <p>この資料は、従来版の第4回 - アニメーション に対応します。
<a href="https://github.com/trnciii/ciesample-animation">このリポジトリ</a>からファイルをダウンロードしたら<code>sample.xcodeproj</code> を開き、実行できるか確認してください。</p>
<h2 id="_1">目次</h2>
<ul>
<li><a href="#準備">準備</a></li>
<li><a href="#プログラムの概要">プログラムの概要</a><ul>
<li><a href="#メインループ">メインループ</a></li>
<li><a href="#描画内容">描画内容</a></li>
</ul>
</li>
<li><a href="#課題1">課題1</a></li>
<li><a href="#ロボットを回そう">ロボットを回そう</a></li>
<li><a href="#ロボットのパーツを動かす">ロボットのパーツを動かす</a></li>
<li><a href="#課題2">課題2</a></li>
<li><a href="#課題3">課題3</a></li>
</ul>
<h2 id="_2">準備</h2>
<p>ここのコードをダウンロード、解凍してください。sample.xcodeproj を開き実行すると回転する立方体が表示されることを確認してください。</p>
<h2 id="_3">プログラムの概要</h2>
<p>このプログラムでは時間(フレーム)を使ったアニメーションを行なっています。メインループでフレーム数の更新を行ない、<code>display(int frame)</code>関数は与えられたフレーム数に応じた描画を行います。</p>
<h3 id="_4">メインループ</h3>
<p>main関数の中では変数<code>frame</code>がフレーム数を覚えておくために使われています。ループ処理ごとにフレーム数が増加していき、フレーム数の上限である<code>MAXFRAME</code>まで進むと0に戻ることをずっと繰り返しています。<code>MAXFRAME</code>は7行目に定義されており、main.cpp の中で使うことができます。</p>
<p>[ main.cpp ]</p>
<pre><code class="language-cpp">// 省略

#define MAXFRAME 300.0

// 省略

int main(void)
{
    // 省略

    int frame = 0; // フレーム数の変数
    do{
        // フレーム数の更新
        // frame は1ずつ増加していき、MAXFRAMEまでいくと0に戻ることを繰り返す
        frame++;
        if(MAXFRAME &lt; frame)
            frame = 0;

        // frame を引数として描画をおこなう
        display(frame);

        glfwSwapBuffers(window);
        glfwPollEvents();
    }while( !glfwWindowShouldClose(window) );

   glfwTerminate();

    return 0;
}
</code></pre>
<h3 id="_5">描画内容</h3>
<p>それでは<code>display(int frame)</code>を見てみましょう。この中でフレームごとに少しずつ異なる画面を描画することでアニメーションの表現ができます。</p>
<p>[ main.cpp ]</p>
<pre><code class="language-cpp">void display(int frame)
{
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    double angle = (double)360*frame/MAXFRAME; // frame から回転角を決める。MAXFRAME で一回転。
    glRotated(angle,0,0,1); // z軸回転させる
    makebox(1.0,1.0,1.0);
}
</code></pre>
<p>具体的にアニメーション（箱の回転）をしているのは、<code>glRotated(angle,0,0,1)</code>の部分です。 今までと違い、回転量が定数ではなく<code>frame</code>を元にした<code>angle</code>という変数になっています。<code>frame</code>の値が刻々と変わるので、箱が回転します。</p>
<h2 id="1">課題1</h2>
<p>以下の処理をさせてください。</p>
<ol>
<li>ボックスが左右に往復するようにしてください。</li>
<li>ボックスを２つ描き、片方が一回転する間に、もう片方は二回転するようにしてください。</li>
<li>斜め上方に放出された小さなボックスが放物線を描いて落下るような動きを作ってみてください。(割と難)<details><summary>ヒント</summary>初速度を与え、y軸方向(鉛直方向)に重力加速度に従って落下させます。つまり、y座標が時間の二次関数になります。なお単位は適当でいいです。</details></li>
<li>たくさんの微小ボックスを爆発的に飛ばし、自由落下させてください。(かなり難)<details><summary>ヒント</summary>たくさんのボックスの位置を記録しておくため、配列を用いましょう。あとはそれぞれのボックス位置を更新してあげればいいです。初速度はランダムに決めるとやりやすいです。</details></li>
</ol>
<h2 id="_6">ロボットを回そう</h2>
<p>前回の授業でロボットをつくりました。これを今度は動かしてみましょう。ボックスが回転するサンプルを改造していきます。(課題1でプログラムを書き換えた人は再度サンプルファイルをダウンロードしてください)</p>
<p>まず<code>makebox()</code>と同じようにロボットを表示する関数を作りましょう。box.hpp とbox.cpp に<code>drawRobot()</code>という関数を追記していきます。</p>
<p>[ box.hpp ]</p>
<pre><code class="language-cpp">#pragma once
#include &quot;GLFW/glfw3.h&quot;

void makebox(double width, double height, double length, GLenum type=GL_LINE_LOOP);

void drawRobot(); //追加

</code></pre>
<p>[ box.cpp ]</p>
<pre><code class="language-cpp">
#include &quot;box.hpp&quot;

void makebox(double width, double height, double length, GLenum type)
{
   // 省略
}

// 追加
void drawRobot()
{
    // ロボットをここに書く
}
</code></pre>
<p>最後に、main.cpp内の<code>draw(int frame)</code>で呼び出している<code>makebox</code>を<code>drawRobot</code>に書き換えます。プログラムを実行すると、前回で作ったロボットが描画されていると思います。</p>
<h2 id="_7">ロボットのパーツを動かす</h2>
<p>今はロボットの全身がぐるぐると回っています。体のパーツごとに動きをつけてみましょう。
変数<code>angle</code>を<code>drawRobot</code>に渡すようにプログラムを変更して腕を振らせてみます。</p>
<p><img alt="" src="docs/swing.gif" /></p>
<p>まず、<code>drawRobot</code>関数に引数をつくります。box.hpp, box.cpp 内でそれぞれ</p>
<p>[ box.hpp, box.cpp ]</p>
<pre><code class="language-cpp">void drawRobot()
</code></pre>
<p>↓</p>
<pre><code class="language-cpp">void drawRobot(double angle)
</code></pre>
<p>のように書き換えます。また、main.cpp での呼び出しを<code>drawRobot(angle)</code>と書き換えます。</p>
<p>あとは変数<code>angle</code>を使ってロボットの姿勢を変えるだけです。ロボットの腕を作っている<code>makebox</code>のすぐ上に<code>glRotated</code>を追記します。</p>
<p>[ box.cpp ]</p>
<pre><code class="language-cpp">glPushMatrix();  //-- 右腕
    glTranslated(-1.2, 0.35, 0);
    glRotated(60*sin(2*M_PI*angle/180), 0, 0.0, 1.0);// 追加
    makebox(1, 0.3, 1, GL_POLYGON);
glPopMatrix();
</code></pre>
<p><code>glRotated</code>引数は左から順に(角度, 軸のx成分, 軸のy成分, 軸のz成分)でした。<br>
回転角について、angle は0度から360度までをぐるぐる回っていますが、sin関数はラジアンでの入力なので適当に変換します。また、腕を降る振幅は上下60度くらいにしてみました。</p>
<p><code>60*sin(2*M_PI*angle/180)</code></p>
<p>回転の軸はz軸(奥行き方向)としたいので、各成分は順に(0,0,1)としました。<br>
この状態で実行してみると、だいたいこのような動きになるのではないでしょうか。</p>
<p><img alt="" src="docs/swing_bcentered.gif" /></p>
<p>現在の設定では、ロボットの腕を回すとき、腕を作っているボックスのちょうど真中を中心にして回転してしまいます。本当は、ロボットの腕の付け根を中心にして回って欲しいので、<code>glTranslated</code>をうまく利用します。</p>
<p>[ box.cpp ]</p>
<pre><code class="language-cpp">glPushMatrix();  //-- 右腕
    glTranslated(-0.5, 0.35, 0); // 3. 右肩の位置まで移動
    glRotated(60*sin(2*M_PI*angle/180), 0, 0.0, 1.0); // 2. 原点を中心に腕を振る
    glTranslated(-0.7, 0, 0); // 1. 原点が回転の中心となるよう移動
    makebox(1, 0.3, 1, GL_POLYGON);
glPopMatrix();
</code></pre>
<p>「移動させてから（原点中心に）回転」と、「（原点中心に）回転させてから移動」とは結果はかなり異なったものになり、組み合わせ方が重要になってきます。OpenGLの場合、変換後に書いたほうから順に行われるのでした。下から順にどのような変換を行なっているかをみてみると、次のようになっています。また、ロボットの正面からみた右腕は、図のように変換されています。</p>
<ol>
<li>まず腕の回転の中心を原点に持ってくるように移動</li>
<li>(原点を中心に)腕の回転</li>
<li>回転した腕を右肩の位置まで移動</li>
</ol>
<p><img alt="" src="docs/transform.jpg" /></p>
<h2 id="2">課題2</h2>
<p>次の手順でロボットを歩かせてみましょう。</p>
<ol>
<li>左右の脚を交互に前後させてください。</li>
<li>腕の振りを加えてください。</li>
<li>全身の上下動作を加えてください。</li>
</ol>
<p>難しいという人は、従来の資料のほうにサンプルがあるので参考にしてください。(すみませんがまだ移植できてません。関数のコピペ動くと思いますが...)</p>
<h2 id="3">課題3</h2>
<p>さらに発展した動きとして次のようなアニメーションを作ってください。</p>
<ul>
<li>ロボットを踊(躍)らせて下さい。腕や足、全身を回転・移動させることで楽しい動きを工夫してください。歩く、走る、跳ぶ、踊る、体操する、その他、何でもＯＫです。</li>
<li>複数の動きを連続的に組み合わせて、ちょっと長めのアニメーションを作ってみてください。</li>
<li>異なる形の二体のロボットを別々に動かしてみてください。(やや難)</li>
</ul>
<p>すべてクリアするのは大変とは思いますが、できる範囲で頑張ってみてください。また、完成した映像をslackのほうに共有してもらえると嬉しいです。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../input/" class="btn btn-neutral float-right" title="マウスやキーボードによる入力">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../box/" class="btn btn-neutral" title="3D 階層構造"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../box/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../input/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
