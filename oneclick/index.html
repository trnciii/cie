<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>ワンクリックアクションの制作 - コンテンツインタラクション演習</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u30ef\u30f3\u30af\u30ea\u30c3\u30af\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u5236\u4f5c";
    var mkdocs_page_input_path = "oneclick/README.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> コンテンツインタラクション演習</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../setup/">環境構築</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">2D 線・円</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../lines/">直線</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../circle/">円</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../surface/">2D 相対移動</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../box/">3D 階層構造</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../animation/">アニメーション</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../input/">マウスやキーボードによる入力</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">ワンクリックアクションの制作</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../timing/">タイミングアクション</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../trace/">軌跡を用いたインタラクション</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">コンテンツインタラクション演習</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>ワンクリックアクションの制作</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <p>この資料は、従来版の後半第2回 - ワンクリックアクションの制作 に対応します。
<a href="https://github.com/trnciii/ciesample-oneclick">このリポジトリ</a>からファイルをダウンロードしたら<code>sample.xcodeproj</code> を開き、実行できるか確認してください。</p>
<h2 id="_1">目次</h2>
<ul>
<li><a href="#準備">準備</a></li>
<li><a href="#プログラムの解説">プログラムの解説</a><ul>
<li><a href="#立方体の配列">立方体の配列</a></li>
<li><a href="#課題1">課題1</a></li>
</ul>
</li>
<li><a href="#マウスクリックによる起爆">マウスクリックによる起爆</a><ul>
<li><a href="#マウスボタン関数の定義">マウスボタン関数の定義</a></li>
<li><a href="#課題2">課題2</a></li>
<li><a href="#課題3">課題3</a></li>
</ul>
</li>
</ul>
<h2 id="_2">準備</h2>
<p>ここのコードをダウンロード、解凍してください。
sample.xcodeproj を開き実行すると以下のような画面が現れます。</p>
<p><img alt="" src="docs/initial.png" /></p>
<h2 id="_3">プログラムの解説</h2>
<p>タイトルはワンクリックアクションの制作となっており、クリックによる操作がテーマではありますが、まずは使用するアニメーションを作ります。 
目標はたくさんの立方体が爆発するように飛び散る動きです。</p>
<p><img alt="" src="docs/exp.gif" /></p>
<h3 id="_4">立方体の配列</h3>
<p>サンプルではたくさんの立方体が不規則な位置に配置されています。これは、それぞれの立方体の位置をグローバル変数として用意し、最初に乱数を用いて座標を決めるという処理をおこなっています。</p>
<p>[ main.cpp ]</p>
<pre><code class="language-cpp">// 一番上
// 立方体256個＊3次元ぶんの値を保存するためのグローバル変数
double pos[3*256];
double vel[3*256]; //あとで使います
bool clicked = false; // あとで使います
//...

void myinit(GLFWwindow** window)
{
    //...

    // pos の初期化
    for(int i=0; i&lt;256; i++){
        pos[3*i  ] = (rand()%100-50)*0.5;
        pos[3*i+1] = (rand()%100-50)*0.5;
        pos[3*i+2] = (rand()%100-50)*0.5;
        // ...
    }
}

//...

void display(int frame)
{
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    // pos の座標に立方体を描く
    for( int i = 0; i &lt; 256; i++ ){
        glPushMatrix();
            glTranslated( pos[3*i], pos[3*i+1], pos[3*i+2] );
            glRotated( 45, 0.0, 1.0, 0.0 );
            makebox( 1.0, 1.0, 1.0, GL_POLYGON );
        glPopMatrix();
    }
}

</code></pre>
<p>まず配列の使い方ですが、今回は256個の立方体を表示するため、それぞれのx, y, z座標を覚えておく必要があります。</p>
<p><code>double pos[3*256]</code> には3次元＊256個の値が格納されます。
データの内容は、{x, y, z}座標値をひとかたまりとして、これが立方体の数だけ並んでいます。</p>
<p><img alt="" src="docs/ar.jpg" /></p>
<p>このようなデータ構造から座標を取り出すには、<strong>かたまりの幅＊立方体の番号</strong>だけ配列を進めるのが便利です。
i番めの立方体のy座標(2番めの要素)を取り出すためには<code>pos[3*i+1]</code>とします。
初期化, 描画の部分でどのように各座標にアクセスしているか確認してください。</p>
<h3 id="1">課題1</h3>
<p>サンプルではすでに各立方体の位置と速度が初期化されています。
<code>display</code>関数のなかで、立方体の位置に速度を加えて更新し、移動させてください。
プログラムの実行と同時に立方体がランダムな方向に動き始めればokです。</p>
<p><img alt="" src="docs/exa.gif" /></p>
<h2 id="_5">マウスクリックによる起爆</h2>
<p>コールバック関数を定義し、クリックした瞬間に一か所にある立方体が爆発するようにします。
具体的には、フラグとなる変数を用意し、クリックが検知されたときに値を書き換えることで立方体を動かすかどうかの判定をおこないます。</p>
<h3 id="_6">マウスボタン関数の定義</h3>
<p>といっても処理が単純かつ覚えるしかない部分でもあるので簡単に流します。
<code>bool click</code>というグローバル変数があるのでマウスボタンの動きを検出する関数<code>MouseButtonFunc</code>の中でこれを書き換えてください。</p>
<p>[ main.cpp ]</p>
<pre><code class="language-cpp">void MouseButtonFunc(GLFWwindow* window, int button, int action, int mods)
{
    if( button == GLFW_MOUSE_BUTTON_LEFT &amp;&amp; action == GLFW_PRESS )
    {
        clicked = true;
    }
}
</code></pre>
<p>if文は、<strong>左ボタン</strong>が<strong>押された</strong>ときという条件です。</p>
<h3 id="2">課題2</h3>
<p>変数<code>clicked</code>が最初は<code>false</code>, クリックされた後は<code>true</code>の値をとるようになりました。
このフラグを用いてマウスボタンがクリックされたときに移動が始まるようにしてください。</p>
<p>さらに、初期位置を原点にして爆発して見えるようにしてください。</p>
<p><img alt="" src="docs/exp.gif" /></p>
<h3 id="3">課題3</h3>
<p>そのほか、マウスボタンを使って動きの制御をおこなってください。
例えばクリックするたびに移動/停止を入れ替える、クリックすると位置を初期化するなど。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../timing/" class="btn btn-neutral float-right" title="タイミングアクション">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../input/" class="btn btn-neutral" title="マウスやキーボードによる入力"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../input/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../timing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
